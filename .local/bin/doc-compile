#!/bin/sh
# doc-compile compiles documents to standard filetypes
# compiles groff, markdown, and TeX files

FILE=$(readlink -f "$1")
DIR=${FILE%/*}
BASE="${FILE%.*}"
EXT="${FILE##*.}"

cd "$DIR" || exit 1

case "$EXT" in
	[0-9]) preconv "$FILE" | refer -PS -e | groff -mandoc -T pdf > "$BASE".pdf ;;
	md) lowdown --parse-no-intraemph "$FILE" -Tms | groff -mpdfmark -ms -kept -T pdf > "$BASE".pdf ;;
	mom) preconv "$FILE" | refer -PS -e | groff -mom -kept -T pdf > "$BASE".pdf ;;
	ms) preconv "$FILE" | refer -PS -e | groff -me -ms -kept -T pdf > "$BASE".pdf ;;
	tex)
		grep -q '^\\addbibresource' "$FILE" &&
			latex "$BASE" &&
			biber "$BASE" &&
			latex "$BASE"
		pdflatex "$BASE"
		#rm "$BASE.aux" "$BASE.log"
		;;
esac
